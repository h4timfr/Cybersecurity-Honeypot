<!DOCTYPE html>
<html>
<head>
    <title>Honeypot SOC Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            background: #0d1117;
            color: #c9d1d9;
            font-family: Arial, sans-serif;
        }
        .card {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 10px;
            padding: 20px;
        }
        table {
            color: #c9d1d9;
            font-size: 14px;
        }
        .table thead { background: #21262d; }
        h1, h3, h4 { color: #58a6ff; }
        canvas {
            background: #161b22;
            padding: 15px;
            border-radius: 12px;
        }
    </style>
</head>
<body class="p-4">

<h1 class="mb-4">ðŸ›¡ Honeypot Security Dashboard</h1>

<!-- Top Stats -->
<div class="row mb-4">
    <div class="col-md-4">
        <div class="card">
            <h4>Total Attacks</h4>
            <div id="total" class="fs-2 text-warning"></div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card">
            <h4>Unique IPs</h4>
            <div id="unique_ips" class="fs-2 text-success"></div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card">
            <h4>Most Targeted Port</h4>
            <div id="top_port" class="fs-2 text-danger"></div>
        </div>
    </div>
</div>

<!-- Logs Table -->
<h3>Recent Attacks</h3>
<div class="card mb-4">
<table class="table table-dark table-striped">
    <thead>
        <tr>
            <th>Timestamp</th>
            <th>IP</th>
            <th>Port</th>
            <th>Payload</th>
        </tr>
    </thead>
    <tbody id="attack_table"></tbody>
</table>
</div>

<!-- Charts -->
<div class="row">
    <div class="col-md-6">
        <h4>Attack Categories</h4>
        <canvas id="categoryChart"></canvas>
    </div>

    <div class="col-md-6">
        <h4>Port Distribution</h4>
        <canvas id="portChart"></canvas>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>

let categoryChart = null;
let portChart = null;

async function loadData() {
    const res = await fetch("/data");
    const data = await res.json();

    // Fill stats
    document.getElementById("total").innerText = data.summary.total;
    document.getElementById("unique_ips").innerText = data.summary.unique_ips;
    document.getElementById("top_port").innerText = data.summary.most_targeted;

    // Fill logs
    const table = document.getElementById("attack_table");
    table.innerHTML = "";
    data.logs.forEach(e => {
        table.innerHTML += `
            <tr>
                <td>${e.timestamp}</td>
                <td>${e.remote_ip}</td>
                <td>${e.port}</td>
                <td>${e.data.slice(0,50)}</td>
            </tr>`;
    });

    // Charts
    renderCategoryChart(data.graph_categories);
    renderPortChart(data.graph_port);
}

// Attack Categories Pie Chart
function renderCategoryChart(categoryData) {
    const labels = Object.keys(categoryData);
    const values = Object.values(categoryData);

    if (categoryChart) categoryChart.destroy();

    categoryChart = new Chart(document.getElementById("categoryChart"), {
        type: 'pie',
        data: {
            labels,
            datasets: [{
                data: values,
                backgroundColor: [
                    "#e74c3c", "#3498db", "#f1c40f",
                    "#9b59b6", "#1abc9c", "#95a5a6"
                ]
            }]
        },
        options: {
            plugins: { legend: { labels: { color: "#fff" } } }
        }
    });
}

// Port Distribution Bar Chart
function renderPortChart(portData) {
    const labels = Object.keys(portData);
    const values = Object.values(portData);

    if (portChart) portChart.destroy();

    portChart = new Chart(document.getElementById("portChart"), {
        type: 'bar',
        data: {
            labels,
            datasets: [{
                label: "Hits",
                data: values,
                backgroundColor: "#3498db"
            }]
        },
        options: {
            plugins: { legend: { labels: { color: "#fff" } } },
            scales: {
                y: { beginAtZero: true, grid: { color: "#333" }, ticks: { color: "#fff" } },
                x: { grid: { color: "#333" }, ticks: { color: "#fff" } }
            }
        }
    });
}

loadData();
setInterval(loadData, 3000);

</script>

</body>
</html>
